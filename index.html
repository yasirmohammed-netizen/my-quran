<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØµØ­Ù Ø§Ù„Ù‡Ø¯Ø§ÙŠØ© - Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¢ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c5d3f; --bg: #fdfaf0; }
        body { font-family: 'Amiri', serif; background-color: var(--bg); margin: 0; padding: 20px; color: #333; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.05); border: 1px solid #e2d7b5; }
        
        header { text-align: center; border-bottom: 2px solid var(--primary); margin-bottom: 20px; padding-bottom: 10px; }
        h1 { color: var(--primary); font-size: 2.5rem; margin: 0; }

        #bookmark-bar { 
            background: #e8f5e9; padding: 12px; border-radius: 10px; 
            margin-bottom: 20px; display: none; align-items: center; 
            justify-content: space-between; border: 1px solid #c8e6c9;
            font-weight: bold; color: var(--primary);
        }
        
        #surah-select { 
            width: 100%; padding: 12px; font-size: 1.2rem; font-family: 'Amiri', serif;
            border: 2px solid var(--primary); border-radius: 8px; margin-bottom: 20px;
        }

        #quran-display { line-height: 3.2; font-size: 2.1rem; text-align: justify; padding: 10px; }
        .ayah { cursor: pointer; transition: 0.2s; border-radius: 5px; padding: 0 4px; }
        .ayah:hover { background: #f1c40f22; }
        .ayah-num { color: var(--primary); font-size: 1.2rem; font-family: Arial; border: 1px solid #ccc; border-radius: 50%; padding: 2px 6px; margin: 0 5px; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª ÙˆØ§Ù„ØªÙØ³ÙŠØ± */
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
        #modal-box { background: white; width: 85%; max-width: 500px; padding: 25px; border-radius: 15px; text-align: center; position: relative; }
        
        .menu-options { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .opt-btn { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-family: 'Amiri'; font-size: 1.1rem; flex: 1; }
        .opt-btn.secondary { background: #f39c12; }
        
        .close-btn { position: absolute; top: 10px; left: 10px; background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        #content-area { margin-top: 20px; text-align: right; font-size: 1.3rem; line-height: 1.6; border-top: 1px solid #eee; padding-top: 15px; display: none; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1>
            <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¢ÙŠØ© Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙØ³ÙŠØ± Ø£Ùˆ Ø­ÙØ¸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø©</p>
        </header>

        <div id="bookmark-bar"></div>
        <select id="surah-select"><option value="">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</option></select>
        <div id="quran-display"></div>
    </div>

    <div id="modal-overlay">
        <div id="modal-box">
            <button class="close-btn" onclick="closeModal()">Ø¥ØºÙ„Ø§Ù‚</button>
            <h3 id="modal-title" style="color:var(--primary); margin-bottom:10px;">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¢ÙŠØ©</h3>
            <p id="ayah-preview" style="font-style: italic; color: #666;"></p>
            
            <div class="menu-options" id="menu-btns">
                <button class="opt-btn" id="btn-tafseer">ğŸ“– Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ³ÙŠØ±</button>
                <button class="opt-btn secondary" id="btn-save">ğŸ“ Ø­ÙØ¸ ÙƒØ¹Ù„Ø§Ù…Ø©</button>
            </div>

            <div id="content-area"></div>
        </div>
    </div>

    <script>
        const select = document.getElementById('surah-select');
        const display = document.getElementById('quran-display');
        const bookmarkBar = document.getElementById('bookmark-bar');
        const overlay = document.getElementById('modal-overlay');
        const contentArea = document.getElementById('content-area');
        const menuBtns = document.getElementById('menu-btns');

        let currentData = {}; // Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ø¤Ù‚ØªØ§Ù‹

        async function loadIndex() {
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            const data = await res.json();
            select.innerHTML = '<option value="">ğŸ“– Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©...</option>';
            data.data.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.number;
                opt.textContent = `${s.number}. ${s.name}`;
                select.appendChild(opt);
            });
            checkBookmark();
        }

        select.onchange = (e) => { if(e.target.value) loadSurah(e.target.value); };

        async function loadSurah(id) {
            display.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
            const res = await fetch(`https://api.alquran.cloud/v1/surah/${id}`);
            const data = await res.json();
            render(data.data);
        }

        function render(surah) {
            display.innerHTML = `<h2 style="text-align:center; color:var(--primary)">ï´¿ ${surah.name} ï´¾</h2>`;
            surah.ayahs.forEach(a => {
                const span
