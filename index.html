<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØµØ­Ù Ø§Ù„Ù‡Ø¯Ø§ÙŠØ© - Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Amiri+Quran&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c5d3f; --bg: #fdfaf0; }
        body { font-family: 'Amiri', serif; background-color: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 850px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); border: 1px solid #e2d7b5; }
        
        header { text-align: center; border-bottom: 2px solid var(--primary); margin-bottom: 15px; padding-bottom: 10px; }
        h1 { color: var(--primary); font-family: 'Amiri Quran', serif; font-size: 2.5rem; margin: 0; }

        #bookmark-bar { 
            background: #e8f5e9; padding: 12px; border-radius: 10px; 
            margin-bottom: 20px; display: none; align-items: center; 
            justify-content: space-between; border: 1px solid #c8e6c9;
            font-weight: bold; color: var(--primary);
        }

        select { 
            width: 100%; padding: 12px; font-size: 1.2rem; font-family: 'Amiri', serif;
            border: 2px solid var(--primary); border-radius: 8px; margin-bottom: 20px; outline: none;
        }

        #quran-display { 
            line-height: 3.5; font-size: 2.2rem; text-align: justify; 
            padding: 10px; font-family: 'Amiri Quran', serif; 
        }
        
        .ayah { cursor: pointer; transition: 0.2s; border-radius: 5px; padding: 0 5px; display: inline; }
        .ayah:hover { background: #f1c40f22; }
        .ayah-num { 
            color: var(--primary); font-size: 1.3rem; font-family: Arial; 
            border: 1px solid #ccc; border-radius: 50%; padding: 2px 8px; margin: 0 5px; 
        }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        #modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
        #modal-box { background: white; width: 90%; max-width: 500px; padding: 25px; border-radius: 15px; text-align: center; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        
        .menu-options { display: flex; gap: 10px; justify-content: center; margin-top: 20px; }
        .opt-btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-family: 'Amiri'; font-size: 1.1rem; flex: 1; transition: 0.3s; }
        .opt-btn:active { transform: scale(0.95); }
        .opt-btn.secondary { background: #f39c12; }
        
        .close-btn { position: absolute; top: -15px; left: -15px; background: #e74c3c; color: white; border: none; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-weight: bold; }
        #content-area { margin-top: 20px; text-align: right; font-size: 1.4rem; line-height: 1.8; border-top: 2px solid #f9f9f9; padding-top: 15px; display: none; color: #444; }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1>
        </header>

        <div id="bookmark-bar"></div>
        
        <select id="surah-select">
            <option value="">ğŸ“– Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙ‡Ø±Ø³...</option>
        </select>

        <div id="quran-display">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø³ÙˆØ±Ø© Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.</div>
    </div>

    <div id="modal-overlay">
        <div id="modal-box">
            <button class="close-btn" onclick="closeModal()">X</button>
            <h3 id="modal-title" style="color:var(--primary); margin:0 0 10px 0;">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¢ÙŠØ©</h3>
            <p id="ayah-preview" style="font-style: italic; color: #777; font-size: 1.1rem;"></p>
            
            <div class="menu-options" id="menu-btns">
                <button class="opt-btn" onclick="showTafseer()">ğŸ“– Ø§Ù„ØªÙØ³ÙŠØ±</button>
                <button class="opt-btn secondary" onclick="saveBookmark()">ğŸ“ Ø­ÙØ¸ Ø§Ù„ÙˆØµÙˆÙ„</button>
            </div>

            <div id="content-area"></div>
        </div>
    </div>

    <script>
        const select = document.getElementById('surah-select');
        const display = document.getElementById('quran-display');
        const bookmarkBar = document.getElementById('bookmark-bar');
        const overlay = document.getElementById('modal-overlay');
        const contentArea = document.getElementById('content-area');
        const menuBtns = document.getElementById('menu-btns');

        let currentData = {}; 

        // 1. ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙˆØ±
        async function loadSurahs() {
            try {
                const res = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await res.json();
                select.innerHTML = '<option value="">ğŸ“– Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©...</option>';
                data.data.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s.number;
                    opt.textContent = `${s.number}. ${s.name}`;
                    select.appendChild(opt);
                });
                checkSavedBookmark();
            } catch (e) {
                select.innerHTML = '<option>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</option>';
            }
        }

        select.onchange = (e) => { if(e.target.value) loadSurah(e.target.value); };

        // 2. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        async function loadSurah(id) {
            display.innerHTML = "<p style='text-align:center'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ§Øª Ø¨Ø§Ù„Ø®Ø· Ø§Ù„Ø¹Ø«Ù…Ø§Ù†ÙŠ...</p>";
            try {
                const res = await fetch(`https://api.alquran.cloud/v1/surah/${id}`);
                const data = await res.json();
                const surah = data.data;
                
                display.innerHTML = `<h2 style="text-align:center; color:var(--primary); font-family:'Amiri Quran'">ï´¿ ${surah.name} ï´¾</h2>`;
                
                surah.ayahs.forEach(a => {
                    const span = document.createElement('span');
                    span.className = 'ayah';
                    span.innerHTML = `${a.text} <span class="ayah-num">${a.numberInSurah}</span> `;
                    span.onclick = () => openOptions(surah.number, surah.name, a.numberInSurah, a.text);
                    display.appendChild(span);
                });
                window.scrollTo(0,0);
            } catch (e) {
                display.innerHTML = "ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ±Ø©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.";
            }
        }

        // 3. ÙØªØ­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
        function openOptions(sId, sName, aNum, aText) {
            currentData = { sId, sName, aNum, aText };
            overlay.style.display = 'flex';
            contentArea.style.display = 'none';
            menuBtns.style.display = 'flex';
            document.getElementById('modal-title').innerText = `Ø³ÙˆØ±Ø© ${sName} - Ø¢ÙŠØ© ${aNum}`;
            document.getElementById('ayah-preview').innerText = aText.substring(0, 100) + "...";
        }

        // 4. Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ±
        async function showTafseer() {
            menuBtns.style.display = 'none';
            contentArea.style.display = 'block';
            contentArea.innerText = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±...";
            
            try {
                const res = await fetch(`https://api.alquran.cloud/v1/ayah/${currentData.sId}:${currentData.aNum}/ar.muyassar`);
                const data = await res.json();
                contentArea.innerText = data.data.text;
            } catch (e) {
                contentArea.innerText = "ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ±.";
            }
        }

        // 5. Ø­ÙØ¸ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
        function saveBookmark() {
            const save = {id: currentData.sId, name: currentData.sName, ayah: currentData.aNum};
            localStorage.setItem('quran_local_bookmark', JSON.stringify(save));
            alert(`âœ… ØªÙ… Ø­ÙØ¸ Ù…ÙƒØ§Ù†Ùƒ Ø¹Ù†Ø¯ Ø³ÙˆØ±Ø© ${currentData.sName}`);
            checkSavedBookmark();
            closeModal();
        }

        function checkSavedBookmark() {
            const saved = JSON.parse(localStorage.getItem('quran_local_bookmark'));
            if(saved) {
                bookmarkBar.style.display = 'flex';
                bookmarkBar.innerHTML = `
                    <span>ğŸ“ ØªÙˆÙ‚ÙØª Ø¹Ù†Ø¯: ${saved.name} (Ø¢ÙŠØ© ${saved.ayah})</span>
                    <button style="background:var(--primary); color:white; border:none; padding:6px 15px; border-radius:5px; cursor:pointer;" 
                    onclick="loadSurah(${saved.id})">Ø§Ù†ØªÙ‚Ø§Ù„ Ø³Ø±ÙŠØ¹</button>
                `;
            }
        }

        function closeModal() { overlay.style.display = 'none'; }

        loadSurahs();
    </script>
</body>
</html>
