<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØµØ­Ù Ø§Ù„Ù‡Ø¯Ø§ÙŠØ© - Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c5d3f; --bg: #fdfaf0; }
        body { font-family: 'Amiri', serif; background-color: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); }
        
        /* ÙˆØ§Ø¬Ù‡Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .auth-box { 
            background: #f1f3f4; padding: 15px; border-radius: 10px; 
            margin-bottom: 20px; text-align: center; border: 1px solid #ddd;
        }
        .auth-box input { padding: 8px; border-radius: 5px; border: 1px solid #ccc; margin: 5px; width: 140px; }
        .btn-auth { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        
        #user-greeting { font-weight: bold; color: var(--primary); margin-bottom: 10px; display: none; }
        #bookmark-bar { background: #e8f5e9; padding: 12px; border-radius: 8px; margin-bottom: 15px; display: none; align-items: center; justify-content: space-between; }
        select { width: 100%; padding: 12px; font-size: 1.1rem; border: 2px solid var(--primary); border-radius: 8px; margin-bottom: 15px; }
        #quran-display { line-height: 2.8; font-size: 1.9rem; text-align: justify; }
        .ayah { cursor: pointer; padding: 0 3px; border-radius: 4px; }
        .ayah:hover { background: #f1c40f22; }
    </style>
</head>
<body>

<div class="container">
    <header style="text-align: center;"><h1>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1></header>

    <div class="auth-box" id="auth-section">
        <p style="margin: 0 0 10px 0;">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ø­ÙØ¸ Ù…ÙƒØ§Ù† ÙˆØµÙˆÙ„Ùƒ ÙˆÙ…Ø²Ø§Ù…Ù†ØªÙ‡</p>
        <input type="text" id="user-id" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
        <input type="password" id="user-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn-auth" onclick="handleLogin()">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button>
    </div>

    <div id="user-greeting">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ <span id="display-username"></span> 
        <button onclick="handleLogout()" style="font-size: 0.7rem; cursor: pointer;">(Ø®Ø±ÙˆØ¬)</button>
    </div>

    <div id="bookmark-bar"></div>
    <select id="surah-select"><option value="">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ÙÙ‡Ø±Ø³...</option></select>
    <div id="quran-display"></div>
</div>

<script>
    // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙØ¹Ù„ÙŠØŒ ØªØ­ØªØ§Ø¬ Ù„Ø±Ø¨Ø· Ù‡Ø°Ø§ Ø¨Ù€ Database Ù…Ø«Ù„ Firebase.
    // Ø­Ø§Ù„ÙŠØ§Ù‹ Ø³Ø£Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø§ÙƒØ§Ø© Ø°ÙƒÙŠØ© (Mock API) Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„ÙÙƒØ±Ø©.

    let currentUser = localStorage.getItem('logged_user') || null;

    async function init() {
        if (currentUser) showUserUI();
        loadSurahIndex();
    }

    function handleLogin() {
        const id = document.getElementById('user-id').value;
        const pass = document.getElementById('user-pass').value;

        if (id.length < 3 || pass.length < 3) {
            alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©");
            return;
        }

        // ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ù‡Ù†Ø§ Ù†Ø±Ø³Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø³ÙŠØ±ÙØ±
        currentUser = id;
        localStorage.setItem('logged_user', id);
        showUserUI();
        alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­");
    }

    function showUserUI() {
        document.getElementById('auth-section').style.display = 'none';
        document.getElementById('user-greeting').style.display = 'block';
        document.getElementById('display-username').innerText = currentUser;
        checkRemoteBookmark();
    }

    function handleLogout() {
        localStorage.removeItem('logged_user');
        location.reload();
    }

    async function loadSurahIndex() {
        const res = await fetch('https://api.alquran.cloud/v1/surah');
        const data = await res.json();
        const select = document.getElementById('surah-select');
        select.innerHTML = '<option value="">ğŸ“– Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©...</option>';
        data.data.forEach(s => {
            const opt = document.createElement('option');
            opt.value = s.number;
            opt.textContent = `${s.number}. ${s.name}`;
            select.appendChild(opt);
        });
    }

    // Ù‡Ù†Ø§ ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function saveUserPlace(sId, sName, aNum) {
        if (!currentUser) {
            alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ø­ÙØ¸ Ù…ÙƒØ§Ù†Ùƒ!");
            return;
        }
        
        const saveKey = `bookmark_${currentUser}`;
        const data = { sId, sName, aNum };
        localStorage.setItem(saveKey, JSON.stringify(data));
        
        alert(`ØªÙ… Ø­ÙØ¸ ÙˆØµÙˆÙ„Ùƒ ÙŠØ§ ${currentUser} ÙÙŠ Ø³ÙˆØ±Ø© ${sName}`);
        checkRemoteBookmark();
    }

    function checkRemoteBookmark() {
        if (!currentUser) return;
        const saved = JSON.parse(localStorage.getItem(`bookmark_${currentUser}`));
        const bar = document.getElementById('bookmark-bar');
        if (saved) {
            bar.style.display = 'flex';
            bar.innerHTML = `<span>ğŸ“ Ù…ÙƒØ§Ù†Ùƒ Ø§Ù„Ù…Ø­ÙÙˆØ¸: ${saved.sName} (${saved.aNum})</span>
                            <button onclick="loadSurah(${saved.sId})">Ø§Ù†ØªÙ‚Ø§Ù„</button>`;
        }
    }

    // ... Ø¨Ù‚ÙŠØ© Ø¯ÙˆØ§Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙˆØ± ÙˆØ¹Ø±Ø¶Ù‡Ø§ (ØªØ³ØªØ®Ø¯Ù… saveUserPlace Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ·)
    init();
</script>
</body>
</html>
