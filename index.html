<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØµØ­Ù Ø§Ù„Ù‡Ø¯Ø§ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2c5d3f; --bg: #fdfaf0; }
        body { font-family: 'Amiri', serif; background-color: var(--bg); margin: 0; padding: 10px; color: #333; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 5px 25px rgba(0,0,0,0.05); border: 1px solid #e2d7b5; }
        header { text-align: center; border-bottom: 2px solid var(--primary); margin-bottom: 15px; }
        h1 { color: var(--primary); font-size: 2.2rem; margin: 10px 0; }
        #bookmark-bar { background: #e8f5e9; padding: 10px; border-radius: 8px; margin-bottom: 15px; display: none; align-items: center; justify-content: space-between; border: 1px solid #c8e6c9; font-weight: bold; }
        select { width: 100%; padding: 12px; font-size: 1.1rem; font-family: 'Amiri'; border: 2px solid var(--primary); border-radius: 8px; margin-bottom: 15px; }
        #quran-display { line-height: 2.8; font-size: 1.8rem; text-align: justify; }
        .ayah { cursor: pointer; border-radius: 5px; padding: 0 3px; }
        .ayah:hover { background: #f1c40f22; }
        .ayah-num { color: var(--primary); font-size: 1.1rem; font-family: Arial; border: 1px solid #ccc; border-radius: 50%; padding: 1px 6px; margin: 0 4px; }
        #modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index:1000; }
        #modal-box { background:white; width:90%; max-width:450px; padding:20px; border-radius:12px; text-align:center; position:relative; }
        .menu-btns { display:flex; gap:10px; margin-top:15px; }
        .btn { flex:1; padding:10px; border:none; border-radius:5px; cursor:pointer; font-family:'Amiri'; font-size:1.1rem; color:white; }
        .btn-tafseer { background:var(--primary); }
        .btn-save { background:#f39c12; }
        .btn-close { position:absolute; top:-10px; left:-10px; background:#e74c3c; border-radius:50%; width:30px; height:30px; cursor:pointer; color:white; border:none; }
    </style>
</head>
<body>

<div class="container">
    <header><h1>Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h1></header>
    <div id="bookmark-bar"></div>
    <select id="surah-select"><option value="">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</option></select>
    <div id="quran-display"></div>
</div>

<div id="modal-overlay">
    <div id="modal-box">
        <button class="btn-close" onclick="closeModal()">X</button>
        <h3 id="m-title" style="color:var(--primary)">Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¢ÙŠØ©</h3>
        <p id="m-preview" style="color:#666; font-style:italic; font-size:1rem;"></p>
        <div id="m-btns" class="menu-btns">
            <button class="btn btn-tafseer" onclick="getTafseer()">ğŸ“– ØªÙØ³ÙŠØ±</button>
            <button class="btn btn-save" onclick="savePlace()">ğŸ“ Ø­ÙØ¸</button>
        </div>
        <div id="m-content" style="display:none; margin-top:15px; text-align:right; border-top:1px solid #eee; padding-top:10px;"></div>
    </div>
</div>

<script>
    const select = document.getElementById('surah-select');
    const display = document.getElementById('quran-display');
    const bar = document.getElementById('bookmark-bar');
    const overlay = document.getElementById('modal-overlay');
    let current = {};

    async function init() {
        try {
            // Ø¥Ø¶Ø§ÙØ© Ù…Ø­Ø§ÙˆÙ„Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§ØªØµØ§Ù„ ÙÙŠ Ø­Ø§Ù„ ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø£ÙˆÙ„
            const res = await fetch('https://api.alquran.cloud/v1/surah');
            if (!res.ok) throw new Error('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
            const data = await res.json();
            select.innerHTML = '<option value="">ğŸ“– Ø§Ø®ØªØ± Ø§Ù„Ø³ÙˆØ±Ø©...</option>';
            data.data.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s.number;
                opt.textContent = `${s.number}. ${s.name}`;
                select.appendChild(opt);
            });
            checkSave();
        } catch (e) {
            select.innerHTML = '<option>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ«</option>';
            console.error(e);
        }
    }

    select.onchange = (e) => { if(e.target.value) loadSurah(e.target.value); };

    async function loadSurah(id) {
        display.innerHTML = "<p style='text-align:center'>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¢ÙŠØ§Øª...</p>";
        const res = await fetch(`https://api.alquran.cloud/v1/surah/${id}`);
        const data = await res.json();
        render(data.data);
    }

    function render(surah) {
        display.innerHTML = `<h2 style="text-align:center; color:var(--primary)">ï´¿ ${surah.name} ï´¾</h2>`;
        surah.ayahs.forEach(a => {
            const span = document.createElement('span');
            span.className = 'ayah';
            span.innerHTML = `${a.text} <span class="ayah-num">${a.numberInSurah}</span> `;
            span.onclick = () => {
                current = {sId:surah.number, sName:surah.name, aNum:a.numberInSurah, text:a.text};
                overlay.style.display='flex';
                document.getElementById('m-preview').innerText = a.text;
                document.getElementById('m-content').style.display='none';
                document.getElementById('m-btns').style.display='flex';
            };
            display.appendChild(span);
        });
    }

    async function getTafseer() {
        document.getElementById('m-btns').style.display='none';
        const content = document.getElementById('m-content');
        content.style.display='block';
        content.innerText = "Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„ØªÙØ³ÙŠØ± Ø§Ù„Ù…ÙŠØ³Ø±...";
        const res = await fetch(`https://api.alquran.cloud/v1/ayah/${current.sId}:${current.aNum}/ar.muyassar`);
        const data = await res.json();
        content.innerText = data.data.text;
    }

    function savePlace() {
        localStorage.setItem('quran_bookmark', JSON.stringify(current));
        alert('âœ… ØªÙ… Ø­ÙØ¸ Ù…ÙƒØ§Ù†Ùƒ');
        checkSave();
        closeModal();
    }

    function checkSave() {
        const s = JSON.parse(localStorage.getItem('quran_bookmark'));
        if(s) {
            bar.style.display='flex';
            bar.innerHTML = `<span>ğŸ“ ØªÙˆÙ‚ÙØª Ø¹Ù†Ø¯: ${s.sName} (${s.aNum})</span><button onclick="loadSurah(${s.sId})" style="cursor:pointer">Ø§Ù†ØªÙ‚Ø§Ù„</button>`;
        }
    }

    function closeModal() { overlay.style.display='none'; }
    init();
</script>
</body>
</html>
